/*! For license information please see index.umd.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.itp=e():t.itp=e()}(this,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(){r=function(){return e};var t,e={},a=Object.prototype,o=a.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",s=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function d(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch(t){d=function(t,e,n){return t[e]=n}}function f(t,e,n,r){var a=e&&e.prototype instanceof y?e:y,o=Object.create(a.prototype),c=new F(r||[]);return i(o,"_invoke",{value:L(t,n,c)}),o}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var h="suspendedStart",m="suspendedYield",v="executing",g="completed",b={};function y(){}function x(){}function E(){}var C={};d(C,l,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(M([])));S&&S!==a&&o.call(S,l)&&(C=S);var O=E.prototype=y.prototype=Object.create(C);function A(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(a,i,c,l){var s=p(t[a],t,i);if("throw"!==s.type){var u=s.arg,d=u.value;return d&&"object"==n(d)&&o.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,c,l)}),(function(t){r("throw",t,c,l)})):e.resolve(d).then((function(t){u.value=t,c(u)}),(function(t){return r("throw",t,c,l)}))}l(s.arg)}var a;i(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}})}function L(e,n,r){var a=h;return function(o,i){if(a===v)throw Error("Generator is already running");if(a===g){if("throw"===o)throw i;return{value:t,done:!0}}for(r.method=o,r.arg=i;;){var c=r.delegate;if(c){var l=k(c,r);if(l){if(l===b)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===h)throw a=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=v;var s=p(e,n,r);if("normal"===s.type){if(a=r.done?g:m,s.arg===b)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(a=g,r.method="throw",r.arg=s.arg)}}}function k(e,n){var r=n.method,a=e.iterator[r];if(a===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,k(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var o=p(a,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,b;var i=o.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,b):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,b)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function F(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function M(e){if(e||""===e){var r=e[l];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function n(){for(;++a<e.length;)if(o.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(n(e)+" is not iterable")}return x.prototype=E,i(O,"constructor",{value:E,configurable:!0}),i(E,"constructor",{value:x,configurable:!0}),x.displayName=d(E,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===x||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,d(t,u,"GeneratorFunction")),t.prototype=Object.create(O),t},e.awrap=function(t){return{__await:t}},A(j.prototype),d(j.prototype,s,(function(){return this})),e.AsyncIterator=j,e.async=function(t,n,r,a,o){void 0===o&&(o=Promise);var i=new j(f(t,n,r,a),o);return e.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},A(O),d(O,u,"Generator"),d(O,l,(function(){return this})),d(O,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=M,F.prototype={constructor:F,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,a){return c.type="throw",c.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var l=o.call(i,"catchLoc"),s=o.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,b):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;_(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:M(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),b}},e}function a(t,e,n,r,a,o,i){try{var c=t[o](i),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,a)}function o(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,o,i,c=[],l=!0,s=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(c.push(r.value),c.length!==e);l=!0);}catch(t){s=!0,a=t}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw a}}return c}}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return l(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}t.r(e),t.d(e,{adicionarFiltrosDeMeses:()=>w,criarBotaoGerarRelatorio:()=>O,criarDataTable:()=>S,criarGrafico:()=>x,criarGraficoBolha:()=>L,criarGraficoMisto:()=>k,filtrosAtuais:()=>f});var s=document.createElement("style");function u(){if(!document.getElementById("loadingSpinner")){var t=document.createElement("div");t.id="loadingSpinner",t.innerHTML='\n      <div class="spinner"></div>\n      <div class="percentage">0%</div>\n    ',document.body.appendChild(t)}}function d(t){var e=document.getElementById("loadingSpinner");if(e){var n=e.querySelector(".percentage");n&&(n.textContent="".concat(Math.min(Math.max(t,0),100),"%"))}}s.textContent="\n  #loadingSpinner {\n    position: fixed;\n    top: 0; left: 0;\n    width: 100%; height: 100%;\n    background: rgba(255,255,255,0.8);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    z-index: 9999;\n  }\n  #loadingSpinner .spinner {\n    border: 8px solid #f3f3f3;\n    border-top: 8px solid #007bff;\n    border-radius: 50%;\n    width: 60px; height: 60px;\n    animation: spin 1s linear infinite;\n  }\n  #loadingSpinner .percentage {\n    margin-top: 12px;\n    font-size: 16px;\n    font-weight: bold;\n    color: #007bff;\n  }\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n",document.head.appendChild(s);var f={},p=[],h=[],m=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],v={"01":"Janeiro","02":"Fevereiro","03":"Março","04":"Abril","05":"Maio","06":"Junho","07":"Julho","08":"Agosto","09":"Setembro",10:"Outubro",11:"Novembro",12:"Dezembro"};function g(t){return 0===Object.keys(f).length?t:t.filter((function(t){return Object.entries(f).every((function(e){var n=i(e,2),r=n[0],a=n[1];if(r.endsWith("_ano")){var o,c=r.replace("_ano",""),l=null===(o=t[c])||void 0===o?void 0:o.slice(0,4);return l&&a.includes(l)}r.endsWith("_duracao");var s=t[r];if(r.includes("data")&&s){var u=s.slice(5,7);s=v[u]}return a.includes(s)}))}))}function b(t,e){var n=new Map;t.forEach((function(t){var r=t[e];if(r){if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(r)){var a=r.slice(5,7);r=v[a]}n.set(r,(n.get(r)||0)+1)}}));var r=Array.from(n.keys()),a=r.map((function(t){return n.get(t)}));return r.every((function(t){return m.includes(t)}))&&(a=(r=m.filter((function(t){return n.has(t)}))).map((function(t){return n.get(t)}))),{labels:r,valores:a}}function y(t,e,n){var r=[{label:"< 30 minutos",min:0,max:30},{label:"> 30m < 45m",min:30,max:45},{label:"> 45m < 60m",min:45,max:60},{label:"> 1h < 24h",min:60,max:1440},{label:"> 24h < 48h",min:1440,max:2880},{label:"> 48h < 72h",min:2880,max:4320},{label:"> 72h < 5d",min:4320,max:7200},{label:"> 5 dias",min:7200,max:1/0}],a=r.map((function(){return 0}));t.forEach((function(t){var o=Date.parse(t[e]),i=Date.parse(t[n]);if(!(isNaN(o)||isNaN(i)||i<o))for(var c=(i-o)/6e4,l=0;l<r.length;l++)if(c>=r[l].min&&c<r[l].max){a[l]++;break}}));var o="".concat(e,"|").concat(n,"_duracao"),i=f[o],c=[],l=[];return r.forEach((function(t,e){a[e]>0&&(!i||i.includes(t.label))&&(c.push(t.label),l.push(a[e]))})),{labels:c,valores:l}}function x(t,e,n,r,a,c,l){var s,u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,p=Array.isArray(c)?o(c):c.slice(),v=e,x=[],w=[],S=t.canvas.parentNode,O=Object.keys(p[0]||{}).find((function(t){return p.every((function(e){return"string"==typeof e[t]&&/^\d{4}-\d{2}-\d{2}/.test(e[t])}))}));if(O){var A=document.createElement("div");Object.assign(A.style,{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"});var j=document.createElement("button");j.textContent="Todos",j.style.cursor="pointer",j.addEventListener("click",(function(){delete f["".concat(O,"_ano")],C()})),A.appendChild(j),Array.from(new Set(p.map((function(t){return t[O].slice(0,4)})))).forEach((function(t){var e=document.createElement("button");e.textContent=t,e.style.cursor="pointer",e.addEventListener("click",(function(){delete f["".concat(O,"_ano")],f["".concat(O,"_ano")]=[t],C()})),A.appendChild(e)}));var L=document.createElement("select");L.appendChild(new Option("Todos meses","")),m.forEach((function(t){return L.appendChild(new Option(t,t))})),L.addEventListener("change",(function(t){var e=t.target.value;e?f[O]=[e]:delete f[O],C()})),A.appendChild(L);var k=document.createElement("select");k.appendChild(new Option("Todos trimestres","")),[["1º",["Janeiro","Fevereiro","Março"]],["2º",["Abril","Maio","Junho"]],["3º",["Julho","Agosto","Setembro"]],["4º",["Outubro","Novembro","Dezembro"]]].forEach((function(t){var e=i(t,2),n=e[0],r=e[1],a=new Option(n,n);a.dataset.meses=r.join(","),k.appendChild(a)})),k.addEventListener("change",(function(t){var e=t.target.selectedOptions[0].dataset.meses;e?f[O]=e.split(","):delete f[O],C()})),A.appendChild(k),S.insertBefore(A,S.firstChild)}function P(){var e,o,i=g(p);if(!1===u){if(!d)throw new Error("parametro_busca_fim obrigatório quando porDuracao=false");var c=y(i,n,d);e=c.labels,o=c.valores}else{var f=b(i,n);e=f.labels,o=f.valores}if(x=e,w=o,s){s.destroy();var m=h.findIndex((function(t){return t.grafico===s}));m>-1&&h.splice(m,1)}var S={type:v,data:{labels:e,datasets:[{label:a,data:o,backgroundColor:r.slice(0,e.length),borderWidth:1}]},options:{responsive:!0,scales:"bar"===v||"line"===v?{x:{beginAtZero:!0},y:{beginAtZero:!0}}:void 0,plugins:{legend:{display:!0,labels:{generateLabels:function(t){var e=t.data.datasets[0];return t.data.labels.map((function(n,r){return{text:n,fillStyle:e.backgroundColor[r],hidden:!t.getDataVisibility(r),index:r}}))}},onClick:function(t,e){var r=s.data.labels[e.index];E(n,u?r:"".concat(n,"|").concat(d,"_duracao:").concat(r)),C()}}}}};(s=new Chart(t,S))._parametro_busca=n;var O=i.length;h.push({grafico:s,dadosOriginais:p,parametro_busca:n,porDuracao:u,parametro_busca_fim:d,callback:l,ultimoTotal:O}),l&&l({total:O,variacaoTexto:null})}P();var _=document.createElement("div");Object.assign(_.style,{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"});var F=document.createElement("select");Object.assign(F.style,{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",cursor:"pointer"}),["bar","line","pie","doughnut","radar","polarArea"].forEach((function(t){var e=document.createElement("option");e.value=t,e.text=t.charAt(0).toUpperCase()+t.slice(1),t===v&&(e.selected=!0),F.appendChild(e)})),F.addEventListener("change",(function(){v=F.value,P()})),_.appendChild(F);var M=document.createElement("button");M.textContent="Ver tabela",Object.assign(M.style,{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",cursor:"pointer",background:"#f9f9f9"}),_.appendChild(M),S.insertBefore(_,t.canvas);var T=document.createElement("div");T.style.display="none",S.appendChild(T);var N=!1;M.addEventListener("click",(function(){if(N=!N){t.canvas.style.display="none",T.style.display="block",M.textContent="Ver gráfico",T.innerHTML="";var e=document.createElement("table");Object.assign(e.style,{width:"100%",borderCollapse:"collapse"});var r=document.createElement("thead"),a=document.createElement("tr");[n,"Valor"].forEach((function(t){var e=document.createElement("th");e.textContent=t,Object.assign(e.style,{border:"1px solid #ddd",padding:"8px",background:"#f5f5f5",textAlign:"left"}),a.appendChild(e)})),r.appendChild(a),e.appendChild(r);var o=document.createElement("tbody");x.forEach((function(t,e){var n=document.createElement("tr");[t,w[e]].forEach((function(t){var e=document.createElement("td");e.textContent=t,Object.assign(e.style,{border:"1px solid #ddd",padding:"8px"}),n.appendChild(e)})),o.appendChild(n)})),e.appendChild(o),T.appendChild(e)}else T.style.display="none",t.canvas.style.display="block",M.textContent="Ver tabela"}))}function E(t,e){f[t]||(f[t]=[]);var n=f[t].indexOf(e);-1===n?f[t].push(e):(f[t].splice(n,1),0===f[t].length&&delete f[t]),C(),p.forEach((function(t){return t.render()})),atualizarTodosOsKPIs()}function C(){h.forEach((function(t){var e=t.grafico,n=t.dadosOriginais,r=t.parametro_busca,a=t.porDuracao,o=t.parametro_busca_fim,i=t.callback,c=t.renderizar;if(c)c();else{var l=g(n),s=a?b(l,r):y(l,r,o),u=s.labels,d=s.valores;if(e.data.labels=u,e.data.datasets[0].data=d,e.update(),i){var f=l.length,p=t.ultimoTotal||f,h=null;if(p>0){var m=(f-p)/p*100;h="".concat(m>0?"+":"").concat(m.toFixed(2),"%")}t.ultimoTotal=f,i({total:f,variacaoTexto:h})}}}))}function w(t,e){m.forEach((function(n){var r=document.createElement("button");r.innerText=n,r.onclick=function(){E(t,e),C()},document.body.appendChild(r)}))}function S(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=Object.assign({itemsPerPage:50,virtualRowHeight:35,debounceTime:200},r),i=e,c=o(i),l=1,s=1,u=function(t,e){t.innerHTML="",function(){if(!document.getElementById("virtual-table-styles")){var t=document.createElement("style");t.id="virtual-table-styles",t.textContent="\n    /* Copie/adapte todo o CSS do seu script.js aqui */\n    .table-header { /* … */ }\n    .celula-clicavel { cursor: pointer; }\n    .table-info { /* … */ }\n    .pagination-controls { /* … */ }\n  ",document.head.appendChild(t)}}();var n=document.createElement("div");n.className="table-info",t.appendChild(n);var r=document.createElement("div");r.className="table-header";var a=document.createElement("table"),o=document.createElement("tr");e.forEach((function(t){var e=document.createElement("th");e.textContent=t,e.dataset.coluna=t,o.appendChild(e)})),a.appendChild(o),r.appendChild(a);var i=document.createElement("div");i.className="table-content";var c=document.createElement("table"),l=document.createElement("tbody");c.appendChild(l),i.appendChild(c);var s=document.createElement("div");return s.className="pagination-controls",t.appendChild(r),t.appendChild(i),t.appendChild(s),{headerEl:r,scrollEl:i,tbodyEl:l,infoEl:n,paginationEl:s}}(t,n),d=(u.headerEl,u.scrollEl,u.tbodyEl),h=u.infoEl,m=u.paginationEl;function v(){c=g(i),l=Math.ceil(c.length/a.itemsPerPage);var t,e,r=(s-1)*a.itemsPerPage,o=c.slice(r,r+a.itemsPerPage);d.innerHTML="",o.forEach((function(t){var e=document.createElement("tr");n.forEach((function(n){var r=document.createElement("td");r.textContent=t[n],r.dataset.coluna=n,r.dataset.valor=t[n],r.classList.add("celula-clicavel"),e.appendChild(r)})),d.appendChild(e)})),t=i.length,e=c.length,Object.keys(f).length>0?h.textContent="Mostrando ".concat(e," de ").concat(t," registros"):h.textContent="Total: ".concat(t," registros"),function(){if(m.innerHTML="",!(l<=1))for(var t=function(t){var e=document.createElement("button");e.textContent=t,t===s&&(e.disabled=!0),e.addEventListener("click",(function(){s=t,v()})),m.appendChild(e)},e=1;e<=l;e++)t(e)}()}t.addEventListener("click",(function(t){t.target.classList.contains("celula-clicavel")&&E(t.target.dataset.coluna,t.target.dataset.valor)})),p.push({render:v}),v()}function O(t,e){var n=document.createElement("button");return n.textContent="Gerar Relatório",Object.assign(n.style,{padding:"6px 12px",borderRadius:"4px",border:"none",background:"#007bff",color:"#fff",cursor:"pointer",margin:"8px 0"}),n.addEventListener("click",(function(){return function(t){return A.apply(this,arguments)}(t)})),e.appendChild(n),n}function A(){var t;return t=r().mark((function t(e){var n,a,o,i,c,l,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:u(),t.prev=1,n=new jsPDF({unit:"pt",format:"a4"}),a=40,n.setFontSize(18),n.text("Relatório de Projeções e Resultados",40,a),a+=25,n.setDrawColor(0,0,0),n.line(40,a,555,a),a+=20,n.setFontSize(11),n.text("Este relatório apresenta os resultados atuais e as projeções baseadas nos dados.",40,a),a+=30,i=(o=h).length,c=o.map((function(t){var e=t.grafico,n=t.dadosOriginais,r=t.parametro_busca,a=e.toBase64Image();return{grafico:e,imgData:a,imgW:515,imgH:e.height/e.width*515,stats:j(n,r)}})),l=r().mark((function t(){var e,o,l,u,f,p,h,m;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=c[s],o=e.grafico,l=e.imgData,u=e.imgW,f=e.imgH,p=e.stats,a+f>780&&(n.addPage(),a=40),n.addImage(l,"PNG",40,a,u,f),a+=f+10,h=o.data.labels,m=o.data.datasets[0].data,n.setFontSize(11),h.forEach((function(t,e){a>780&&(n.addPage(),a=40),n.text("".concat(t,": ").concat(m[e]," atendimentos"),40,a),a+=14})),a+=10,"SLA"!==o.data.datasets[0].label){t.next=18;break}return n.setFontSize(12),n.text("SLA – Variação Ano a Ano por Faixa de Tempo:",40,a),a+=18,p.statsPorCategoria.forEach((function(t){a>780&&(n.addPage(),a=40);var e=(t.categoria.match(/> *([^<]+)/)||[])[1]||t.categoria;n.setFontSize(11),n.text("> ".concat(e.trim(),": ").concat(t.variacaoAno.toFixed(2),"%"),60,a),a+=14})),a+=20,d(Math.round((s+1)/i*100)),t.abrupt("return",1);case 18:a>760&&(n.addPage(),a=40),n.setFontSize(12),n.text("Variação Ano a Ano (".concat(p.anoAnterior," → ").concat(p.anoRecente,"):"),40,a),a+=18,p.statsPorCategoria.forEach((function(t){a>780&&(n.addPage(),a=40),n.setFontSize(11),n.text("".concat(t.categoria,": ").concat(t.variacaoAno.toFixed(2),"%"),60,a),a+=14})),(a+=20)>760&&(n.addPage(),a=40),n.setFontSize(12),n.text("Variação Mês a Mês (".concat(p.anoAnterior," → ").concat(p.anoRecente,"):"),40,a),a+=18,p.statsPorCategoria.forEach((function(t){a>780&&(n.addPage(),a=40),n.setFontSize(11),n.text("Categoria ".concat(t.categoria,":"),60,a),a+=14,t.variacaoMeses.forEach((function(t){a>780&&(n.addPage(),a=40),n.text("   ".concat(t.mes,": ").concat(t.variacao.toFixed(2),"%"),80,a),a+=14})),a+=10})),(a+=20)>760&&(n.addPage(),a=40),n.setFontSize(12),n.text("Variação em Relação ao Mês Anterior (".concat(p.anoRecente,"):"),40,a),a+=18,p.statsPorCategoria.forEach((function(t){a>780&&(n.addPage(),a=40),n.setFontSize(11),n.text("Categoria ".concat(t.categoria,":"),60,a),a+=14,t.variacaoMensal.forEach((function(t){a>780&&(n.addPage(),a=40),n.text("   ".concat(t.mes,": ").concat(t.variacao.toFixed(2),"%"),80,a),a+=14})),a+=10})),a+=20,d(Math.round((s+1)/i*100));case 37:case"end":return t.stop()}}),t)})),s=0;case 18:if(!(s<i)){t.next=25;break}return t.delegateYield(l(),"t0",20);case 20:if(!t.t0){t.next=22;break}return t.abrupt("continue",22);case 22:s++,t.next=18;break;case 25:n.save("Relatorio_Visual_Completo.pdf");case 26:return t.prev=26,e=void 0,(e=document.getElementById("loadingSpinner"))&&e.remove(),t.finish(26);case 29:case"end":return t.stop()}var e}),t,null,[[1,,26,29]])})),A=function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function c(t){a(i,r,o,c,l,"next",t)}function l(t){a(i,r,o,c,l,"throw",t)}c(void 0)}))},A.apply(this,arguments)}function j(t,e){var n=Object.keys(t[0]||{}).find((function(e){return/^\d{4}-\d{2}-\d{2}/.test(t[0][e])}));if(!n)return{anoRecente:null,anoAnterior:null,statsPorCategoria:[]};var r={};t.forEach((function(t){var a=t[n],o=a.slice(0,4),i=a.slice(5,7),c=t[e]||"—",l="".concat(o,"|").concat(i,"|").concat(c);r[l]=(r[l]||0)+1}));var a=Array.from(new Set(Object.keys(r).map((function(t){return t.split("|")[0]})))).sort();if(a.length<2)return{anoRecente:a.pop(),anoAnterior:null,statsPorCategoria:[]};var o=a.pop(),i=a.pop(),c=Array.from(new Set(Object.keys(r).map((function(t){return t.split("|")[2]})))).map((function(t){var e=0,n=0,a=[],c=[],l=[],s=[];m.forEach((function(c,u){var d=String(u+1).padStart(2,"0"),f=r["".concat(o,"|").concat(d,"|").concat(t)]||0,p=r["".concat(i,"|").concat(d,"|").concat(t)]||0;l.push(f),s.push(p),e+=f,n+=p;var h=p?(f-p)/p*100:0;a.push({mes:c,variacao:h})}));for(var u=n?(e-n)/n*100:0,d=0;d<m.length;d++){var f=m[d];if(0===d)c.push({mes:f,variacao:0});else{var p=l[d],h=l[d-1],v=h?(p-h)/h*100:0;c.push({mes:f,variacao:v})}}return{categoria:t,variacaoAno:u,variacaoMeses:a,variacaoMensal:c}}));return{anoRecente:o,anoAnterior:i,statsPorCategoria:c}}function L(t,e,n,r,a,i){var c,l=o(a);function s(t,e){var n={},r=1;return t.forEach((function(t){var a=t[e];a in n||(n[a]=r++)})),function(t){return n[t]||0}}function u(){var a=g(l),o=a.some((function(t){return isNaN(parseFloat(t[e]))})),u=a.some((function(t){return isNaN(parseFloat(t[n]))})),d=a.some((function(t){return isNaN(parseFloat(t[r]))})),f=o?s(a,e):function(t){return parseFloat(t)||0},p=u?s(a,n):function(t){return parseFloat(t)||0},h=d?s(a,r):function(t){return parseFloat(t)||5},m=a.map((function(t,a){return{x:f(t[e]),y:p(t[n]),r:h(t[r]),backgroundColor:i[a%i.length]}}));if(c)c.data.datasets[0].data=m,c.update();else{var v={type:"bubble",data:{datasets:[{label:"Gráfico de Bolhas (".concat(e,", ").concat(n,", ").concat(r,")"),data:m,backgroundColor:m.map((function(t){return t.backgroundColor}))}]},options:{responsive:!0,scales:{x:{title:{display:!0,text:e},beginAtZero:!0},y:{title:{display:!0,text:n},beginAtZero:!0}}}};c=new Chart(t,v)}}u(),h.push({grafico:c,renderizar:u})}function k(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=Array.isArray(e)?o(e):e.slice();function i(){var e=g(a),o={},i={};e.forEach((function(t){var e=new Date(t.data_resolucao);if(!isNaN(e.getTime())){var n=e.getMonth(),r=m[n];o[r]||(o[r]=0),i[r]||(i[r]=0),o[r]++,"Excelente"===t.nota&&i[r]++}}));var c=m,l=c.map((function(t){return o[t]||0})),s=c.map((function(t){return i[t]||0})),u=["rgba(255, 99, 132, 0.7)","rgba(153, 102, 255, 0.7)","rgba(54, 162, 235, 0.7)","rgba(255, 205, 86, 0.7)","rgba(139, 69, 19, 0.7)","rgba(75, 192, 192, 0.7)","rgba(255, 99, 132, 0.7)","rgba(153, 102, 255, 0.7)","rgba(54, 162, 235, 0.7)","rgba(255, 205, 86, 0.7)","rgba(139, 69, 19, 0.7)","rgba(75, 192, 192, 0.7)"];n&&n.destroy(),n=new Chart(t,{type:"bar",data:{labels:c,datasets:[{type:"bar",label:"Total de atendimentos",data:l,backgroundColor:u,borderColor:u.map((function(t){return t.replace("0.7","1")})),borderWidth:1},{type:"line",label:'Notas "Excelente"',data:s,borderColor:"rgba(255, 99, 132, 1)",backgroundColor:"rgba(255, 99, 132, 0.3)",borderWidth:2,tension:.3,fill:!1,yAxisID:"y"}]},options:{responsive:!0,plugins:{title:{display:!!r,text:r},legend:{position:"top"}},scales:{x:{},y:{beginAtZero:!0}}}})}i(),h.push({grafico:n,dadosOriginais:a,renderizar:i})}return e})()));